import org.w3c.dom.*;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.transform.*;
import javax.xml.transform.dom.DOMSource;
import javax.xml.transform.stream.StreamResult;
import java.io.StringWriter;

public class XMLTransformer {
    public static void main(String[] args) throws Exception {
        String inputXML = """
                <UpdatePUPDetails>
                    <AccountDetails>
                        <AccountType>CDO##DR##CR</AccountType>
                        <Currency>USD</Currency>
                    </AccountDetails>
                </UpdatePUPDetails>
                """;

        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        DocumentBuilder builder = factory.newDocumentBuilder();
        Document document = builder.parse(new java.io.ByteArrayInputStream(inputXML.getBytes()));

        NodeList accountDetailsList = document.getElementsByTagName("AccountDetails");
        Document newDocument = builder.newDocument();
        Element root = newDocument.createElement("UpdatePUPDetails");
        newDocument.appendChild(root);

        for (int i = 0; i < accountDetailsList.getLength(); i++) {
            Element accountDetails = (Element) accountDetailsList.item(i);
            String accountTypeText = accountDetails.getElementsByTagName("AccountType").item(0).getTextContent();
            String currencyText = accountDetails.getElementsByTagName("Currency").item(0).getTextContent();

            // Split the AccountType value
            String[] accountTypes = accountTypeText.split("##");

            for (String accountType : accountTypes) {
                Element newAccountDetails = newDocument.createElement("AccountDetails");
                Element newAccountType = newDocument.createElement("AccountType");
                newAccountType.setTextContent(accountType);
                Element newCurrency = newDocument.createElement("Currency");
                newCurrency.setTextContent(currencyText);

                newAccountDetails.appendChild(newAccountType);
                newAccountDetails.appendChild(newCurrency);
                root.appendChild(newAccountDetails);
            }
        }

        // Convert the new Document to a String
        TransformerFactory transformerFactory = TransformerFactory.newInstance();
        Transformer transformer = transformerFactory.newTransformer();
        transformer.setOutputProperty(OutputKeys.INDENT, "yes");
        DOMSource source = new DOMSource(newDocument);
        StringWriter writer = new StringWriter();
        StreamResult result = new StreamResult(writer);
        transformer.transform(source, result);

        System.out.println(writer.toString());
    }
}
